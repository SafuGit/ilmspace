// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../prisma-generated"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String          @id @default(cuid())
  name          String?
  email         String          @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
  // Optional for WebAuthn support
  Authenticator Authenticator[]
  books Book[]
  playlists Playlist[]
  notebook Notebook?
  timestampNotes TimestampNote[]
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
 
model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@id([provider, providerAccountId])
}
 
model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
 
model VerificationToken {
  identifier String
  token      String
  expires    DateTime
 
  @@id([identifier, token])
}
 
// Optional for WebAuthn support
model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?
 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@id([userId, credentialID])
}

model Book {
  id String @id @default(cuid())
  userId String

  title String
  author String?
  language String?
  description String?
  category Categories?
  
  fileUrl String
  secureUrl String
  publicId String

  fileSize Int // Bytes
  pageCount Int? 
  mimeType String @default("application/pdf")

  thumbnailUrl String? // First page

  uploadedAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastOpenedAt DateTime

  currentPage Int @default(0)
  readingProgress Float @default(0.0)

  notebookId String?
  playlists Playlist[]
  timestampNotes TimestampNote[]

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  notebook Notebook? @relation("BookNotebook", fields: [notebookId], references: [id])

  @@index([id])
  @@index([title])
  @@unique([id, title])
}

model Playlist {
  id String @id @default(cuid())
  userId String
  name String
  description String?
  playlistUrl String
  thumbnailUrl String?
  numberOfEpisodes Int?
  books Book[]
  videos Video[]
  timestampNotes TimestampNote[]
  notebook Notebook?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Video {
  id String @id @default(cuid())
  playlistId String
  title String
  description String?
  videoUrl String
  duration Int?

  playlist Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  timestampNotes TimestampNote[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notebook {
  id String @id @default(cuid())
  userId String @unique
  playlistId String? @unique
  name String
  description String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  books Book[] @relation("BookNotebook")
  pages Page[]
  playlist Playlist? @relation(fields: [playlistId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Page {
  id String @id @default(cuid())
  notebookId String
  pageNumber Int
  page1 String?
  page2 String?
  page3 String?
  page4 String?
  page5 String?
  page6 String?
  page7 String?
  page8 String?
  page9 String?
  page10 String?
  page11 String?
  page12 String?
  page13 String?
  page14 String?
  page15 String?

  notebook Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TimestampNote {
  id String @id @default(cuid())
  userId String
  bookId String?
  playlistId String?
  videoId String?
  content String
  timestamp String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  video Video? @relation(fields: [videoId], references: [id], onDelete: Cascade)
  playlist Playlist? @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  book Book? @relation(fields: [bookId], references: [id], onDelete: Cascade)
}

// model Note {
//   id String @id @default(cuid())
//   noteType NoteTypes
//   userId String
//   bookId String?
//   playlistId String?
//   content String
//   pageNumber Int?
//   timestamp String?

//   user User @relation(fields: [userId], references: [id], onDelete: Cascade)
//   page Page @relation(fields: [pageNumber], references: [pageNumber], onDelete: Cascade)
// }

// enum NoteTypes {
//   dars
//   book
// }

enum Categories {
  Quran
  Tafsir
  Hadith
  Aqeedah
  Fiqh
  UsulFiqh
  Arabic
  Seerah
  History
  Tazkiyah
  Adab
  Duas
  Prophets
  Biography
  ComparativeReligion
  Family
  Youth
  Ethics
  Spirituality
  Dawah
  Misc
}